//! <https://leetcode.com/problems/count-palindromic-subsequences/>

struct Solution {}

/// time-complexity : O(n)
/// space-complexity : O(n)
impl Solution {
    pub fn count_palindromes(s: String) -> i32 {
        let mut total: i64 = 0;
        let n = s.len();
        if n < 5 {
            return 0;
        }

        let mut digit_count = [0; 10];
        let mut prefix_counts = vec![[[0; 10]; 10]; n];
        for (index, c) in s.bytes().enumerate() {
            let c = c - b'0';
            if index > 0 {
                for (i, dc) in digit_count.iter().enumerate() {
                    for j in 0usize..10 {
                        prefix_counts[index][i][j] = prefix_counts[index - 1][i][j];
                        if j == c.into() {
                            prefix_counts[index][i][j] += dc;
                        }
                    }
                }
            }
            digit_count[c as usize] += 1;
        }

        digit_count = [0; 10];
        let mut suffix_counts = vec![[[0; 10]; 10]; n];
        for (index, c) in s.bytes().enumerate().rev() {
            let c = c - b'0';
            if index < n - 1 {
                for (i, dc) in digit_count.iter().enumerate() {
                    for j in 0usize..10 {
                        suffix_counts[index][i][j] = suffix_counts[index + 1][i][j];
                        if j == c.into() {
                            suffix_counts[index][i][j] += dc;
                        }
                    }
                }
            }
            digit_count[c as usize] += 1;
        }

        for index in 2..n - 2 {
            for i in 0..10 {
                for j in 0..10 {
                    total = (total
                        + prefix_counts[index - 1][i][j] * suffix_counts[index + 1][i][j])
                        % 1000000007;
                }
            }
        }

        total as i32
    }
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_cases() {
        assert_eq!(Solution::count_palindromes("103301".into()), 2);
        assert_eq!(Solution::count_palindromes("0000000".into()), 21);
        assert_eq!(Solution::count_palindromes("9999900000".into()), 2);
        assert_eq!(Solution::count_palindromes("3".into()), 0);
        assert_eq!(Solution::count_palindromes("1011000010111110011110000010101110101110111011100101100010001101011010001111011110100110111101001010100001100001010001001001000110100011100111000111001010001010011110000010001010110010101110001100111100101101000011101111100110100010011011110010111101110110101000111011011110010100110001101000110101001011011100010000000000011101001001010110101111100010010000001000001011010001110001101100111110001000000110110101101010011101001001101010011010101101101010111110110110101101110000111010001110111110011001011000010011110001101011110001101011101011110110011100111011111110001000101110111001010010111011110110011111101010000100011000001000110001111011100010001000001111100010101100101100001100100011111101010110100100000101110011111100011010101111001110011010111100000010010110101000010011101111110110000100010011001100110010010101111101010001000011111111110100111101110011000110011111100011101110110111111001011100111110000111100111011000001110000100110010101000111000111011000100111101010001111111000110111010110110000111011000001011100010100111010101010110101111110001100100010010111000011001101011011101101101101001111101100111001001101101000010110110110101010111111111011001001100101000101110100010111110010001110101010110000111001101000110000011100101100010100101001111100000100100010101011011010110111010000011000000110100000100110111000010110010000011110000001000010101010010100000110110101001001111011111110000010010001101101111010110101101000111001001100001000001010100000010011000111001001011000111000010001011111111000001000011011101110010101111001101111011101110011001111010101001111011011110110011000000110000000000110101101010110000101010100001010011001100101010000111111111110110101111111111100010001111001000000110010110000010001111111011000001100001101111101001011110001011110101011100101111011000000000000111001010000101000011101111111101100000100101011110011100100011101110000001110010011110001001101101010101110111010101010100101000010000110111010110101111100010111100001110010111101011101111111100010001111000111111011111111011111010110111010100011010000101111101001101011001001000110000101010000111010110011110000101000000111001101100100101011011000100101110101110101111011100010100111000100011011110101101110001010011000011100011010101001101110101011001010010011000111000100111110001101111001111100110111000100010001000100001110100101011111111110111000001100011101001100011101000101001101001100110111110010001101101010111110010010010000110001010011001111101011101000001101011001010001001001001000000010110101100111000010100000000000111110010101111011001100101000001100101000100111001010100001100100011110101110010100000101001100011011010011010001100000011001110010100001101000010111110001010101100101111001001000100100110110001010011010000010000011000100110001001011010000111011010101101000000011100001110000101010011101110111001100001000010100101110110001000101010011011100011011010001110110000011100101101001111011100101001001010110101011011111001111000011010111111110001111011011010000100000000110100101010100010111100010000011011011010001011000111000111100110011110111000010010100101001111000001001010000101110000111101011010010010001110010001001001100101001101101000001100001100001110100101000001111000100101100110000101111000101000000101100101101011110001101111001000000010100000110110000000010110010001001111111111011011111101101011001010101011110010011111000110110011100011001111110001001111100100100110001111010010111010011011110011001111100000101001111001100101110111100001001100100000111110001010101010100110111101001110111100010110101111100011011000000011100000111011110110001011001101000000010000111100111100111111110111110011101111010111001101000111110011110010100100010111111000011010101010001101101000111000000000001011100111100001101100111001000001000001101001100001110001101000001111001110100010000100000100111011101010110011000101111110000010001000110010110010001110000000111001100100101011001101011001000011000100010010110001001100010111011111101110101011010001".into()), 379753341);
    }
}
